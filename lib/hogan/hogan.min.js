/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

var e=function(){function e(e){this.text=e}function n(e){var t=String(e===null?"":e);return a.test(t)?t.replace(r,"&amp;").replace(i,"&lt;").replace(s,"&gt;").replace(o,"&#39;").replace(u,"&quot;"):t}e.prototype={r:function(e,t){return""},v:n,render:function(e,t){return this.r(e,t)},rp:function(e,t,n,r){var i=n[e];return i?i.render(t,n):""},rs:function(e,t,n){var r="",i=e[e.length-1];if(!f(i))return r=n(e,t),r;for(var s=0;s<i.length;s++)e.push(i[s]),r+=n(e,t),e.pop();return r},s:function(e,t,n,r,i,s){if(f(e)&&e.length===0)return!1;!r&&typeof e=="function"&&(e=this.ls(e,t,n,i,s));var o=e===""||!!e;return!r&&o&&t&&t.push(typeof e=="object"?e:t[t.length-1]),o},d:function(e,t,n,r){if(e==="."&&f(t[t.length-2]))return t[t.length-1];var i=e.split("."),s=this.f(i[0],t,n,r),o=null;for(var u=1;u<i.length;u++)s&&typeof s=="object"&&i[u]in s?(o=s,s=s[i[u]]):s="";return r&&!s?!1:(!r&&typeof s=="function"&&(t.push(o),s=this.lv(s,t,n),t.pop()),s)},f:function(e,t,n,r){var i=!1,s=null,o=!1;for(var u=t.length-1
;u>=0;u--){s=t[u];if(s&&typeof s=="object"&&e in s){i=s[e],o=!0;break}}return o?(!r&&typeof i=="function"&&(i=this.lv(i,t,n)),i):r?!1:""},ho:function(e,n,r,i){var s=e.call(n,i,function(e){return t.compile(e).render(n)}),o=t.compile(s.toString()).render(n,r);return this.b=o,!1},b:"",ls:function(e,t,n,r,i){var s=t[t.length-1];if(e.length>0)return this.ho(e,s,n,this.text.substring(r,i));var o=e.call(s);return typeof o=="function"?this.ho(o,s,n,this.text.substring(r,i)):o},lv:function(e,n,r){var i=n[n.length-1];return t.compile(e.call(i).toString()).render(i,r)}};var r=/&/g,i=/</g,s=/>/g,o=/\'/g,u=/\"/g,a=/[&<>\"\']/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};return e}(),t=function(){function t(e){function t(){p.length>0&&(d.push(new String(p)),p="")}function i(){var e=!0;for(var t=b;t<d.length;t++){e=d[t].tag&&y[d[t].tag]<y._v||!d[t].tag&&d[t].match(g)==null;if(!e)return!1}return e}function s(e,n){t();if(e&&i())for(var r=b;r<d.length;r++)d[r].
tag||d.splice(r,1);else n||d.push({tag:"\n"});v=!1,b=d.length}function o(e,t){var r="="+E,i=e.indexOf(r,t),s=n(e.substring(e.indexOf("=",t)+1,i)).split(" ");return w=s[0],E=s[1],i+r.length-1}var u=e.length,a=0,f=1,l=2,c=a,h=null,p="",d=[],v=!1,m=0,b=0,w="{{",E="}}";for(m=0;m<u;m++)if(c==a)r(w,e,m)?(--m,t(),c=f):e[m]=="\n"?s(v):p+=e[m];else if(c==f){m+=w.length-1;var S=y[e[m+1]];h=S?e[m+1]:"_v",v=m,h=="="?(m=o(e,m),c=a):(S&&m++,c=l)}else r(E,e,m)?(m+=E.length-1,d.push({tag:h,n:n(p),i:h=="/"?v-1:m+1}),p="",c=a,h=="{"&&m++):p+=e[m];return s(v,!0),d}function n(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function r(e,t,n){if(t[n]!=e[0])return!1;for(var r=1,i=e.length;r<i;r++)if(t[n+r]!=e[r])return!1;return!0}function i(e,t,n,r){var u=[],a=null,f=null;while(e.length>0){f=e.shift();if(f.tag=="#"||f.tag=="^"||s(f,r))n.push(f),f.nodes=i(e,f.tag,n,r),u.push(f);else{if(f.tag=="/"){if(n.length==0)throw new Error("Closing tag without opener: /"+f.n);a=n.pop();if(f.n!=a.n&&!o(f.n,a.n,r))throw new 
Error("Nesting error: "+a.n+" vs. "+f.n);return a.end=f.i,u}u.push(f)}}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return u}function s(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n)return e.tag="#",!0}function o(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function u(t,n,r){var i='var c = [cx];var b = "";var _ = this;'+l(t)+"return b;";if(r.asString)return"function(cx,p){"+i+";};";var s=new e(n);return s.r=new Function("cx","p",i),s}function a(e){return e.replace(S,"\\\\").replace(b,'\\"').replace(w,"\\n").replace(E,"\\r")}function f(e){return~e.indexOf(".")?"d":"f"}function l(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=e[n].tag;i=="#"?t+=c(e[n].nodes,e[n].n,f(e[n].n),e[n].i,e[n].end):i=="^"?t+=h(e[n].nodes,e[n].n,f(e[n].n)):i=="<"||i==">"?t+=p(e[n].n):i=="{"||i=="&"?t+=d(e[n].n,f(e[n].n)):i=="\n"?t+=m("\n"):i=="_v"?t+=v(e[n].n,f(e[n].n)):i===undefined&&(t+=m(e[n]))}return t}function c(e,t,n,r,i){var s="if(_.s(_."+n+'("'+a(t)+'",c,p,1),'
;return s+="c,p,0,"+r+","+i+")){",s+="b += _.rs(c,p,",s+='function(c,p){ var b = "";',s+=l(e),s+="return b;});c.pop();}",s+='else{b += _.b; _.b = ""};',s}function h(e,t,n){var r="if (!_.s(_."+n+'("'+a(t)+'",c,p,1),c,p,1,0,0)){';return r+=l(e),r+="};",r}function p(e){return'b += _.rp("'+a(e)+'",c[c.length - 1],p);'}function d(e,t){return"b += (_."+t+'("'+a(e)+'",c,p,0));'}function v(e,t){return"b += (_.v(_."+t+'("'+a(e)+'",c,p,0)));'}function m(e){return'b += "'+a(e)+'";'}var g=/\S/,y={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10},b=/\"/g,w=/\n/g,E=/\r/g,S=/\\/g;return{scan:t,parse:function(e,t){return t=t||{},i(e,"",[],t.sectionTags||[])},cache:{},compile:function(e,n){n=n||{};var r=this.cache[e];return r?r:(r=u(this.parse(t(e),n),e,n),this.cache[e]=r)}}}();typeof module!="undefined"&&module.exports?(module.exports=t,module.exports.Template=e):typeof exports!="undefined"&&(exports.Hogan=t,exports.HoganTemplate=e);