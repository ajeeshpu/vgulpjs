/**
 * Durandal 2.0.1 Copyright (c) 2012 Blue Spire Consulting, Inc. All Rights Reserved.
 * Available via the MIT license.
 * see: http://durandaljs.com or https://github.com/BlueSpire/Durandal for details.
 */

define(["durandal/system"],function(e){var t=/\s+/,n=function(){},r=function(e,t){this.owner=e,this.events=t};return r.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},r.prototype.on=r.prototype.then,r.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,i){var s,o,u;if(!n)return new r(this,e);s=this.callbacks||(this.callbacks={}),e=e.split(t);while(o=e.shift())u=s[o]||(s[o]=[]),u.push(n,i);return this},n.prototype.off=function(n,r,i){var s,o,u,a;if(!(o=this.callbacks))return this;if(!(n||r||i))return delete this.callbacks,this;n=n?n.split(t):e.keys(o);while(s=n.shift()){if(!(u=o[s])||!r&&!i){delete o[s];continue}for(a=u.length-2;a>=0;a-=2)r&&u[a]!==r||i&&u[a+1]!==i||u.splice(a,2)}return this},n.prototype.trigger=function(e){var n,r,i,s,o,u,a,f;if(!(r=this.callbacks))return this;f=[],e=e.split(
t);for(s=1,o=arguments.length;s<o;s++)f[s-1]=arguments[s];while(n=e.shift()){if(a=r.all)a=a.slice();if(i=r[n])i=i.slice();if(i)for(s=0,o=i.length;s<o;s+=2)i[s].apply(i[s+1]||this,f);if(a){u=[n].concat(f);for(s=0,o=a.length;s<o;s+=2)a[s].apply(a[s+1]||this,u)}}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n});