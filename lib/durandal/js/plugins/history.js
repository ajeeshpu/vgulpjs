/**
 * Durandal 2.0.1 Copyright (c) 2012 Blue Spire Consulting, Inc. All Rights Reserved.
 * Available via the MIT license.
 * see: http://durandaljs.com or https://github.com/BlueSpire/Durandal for details.
 */

define(["durandal/system","jquery"],function(e,t){function o(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}var n=/^[#\/]|\s+$/g,r=/^\/+|\/+$/g,i=/msie [\w.]+/,s=/\/$/,u={interval:50,active:!1};return typeof window!="undefined"&&(u.location=window.location,u.history=window.history),u.getHash=function(e){var t=(e||u).location.href.match(/#(.*)$/);return t?t[1]:""},u.getFragment=function(e,t){if(e==null)if(u._hasPushState||!u._wantsHashChange||t){e=u.location.pathname+u.location.search;var r=u.root.replace(s,"");e.indexOf(r)||(e=e.substr(r.length))}else e=u.getHash();return e.replace(n,"")},u.activate=function(s){u.active&&e.error("History has already been activated."),u.active=!0,u.options=e.extend({},{root:"/"},u.options,s),u.root=u.options.root,u._wantsHashChange=u.options.hashChange!==!1,u._wantsPushState=!!u.options.pushState,u._hasPushState=!!(u.options.pushState&&u.history&&u.history.pushState);var o=u.getFragment(),a=document.documentMode
,f=i.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7);u.root=("/"+u.root+"/").replace(r,"/"),f&&u._wantsHashChange&&(u.iframe=t('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,u.navigate(o,!1)),u._hasPushState?t(window).on("popstate",u.checkUrl):u._wantsHashChange&&"onhashchange"in window&&!f?t(window).on("hashchange",u.checkUrl):u._wantsHashChange&&(u._checkUrlInterval=setInterval(u.checkUrl,u.interval)),u.fragment=o;var l=u.location,c=l.pathname.replace(/[^\/]$/,"$&/")===u.root;if(u._wantsHashChange&&u._wantsPushState){if(!u._hasPushState&&!c)return u.fragment=u.getFragment(null,!0),u.location.replace(u.root+u.location.search+"#"+u.fragment),!0;u._hasPushState&&c&&l.hash&&(this.fragment=u.getHash().replace(n,""),this.history.replaceState({},document.title,u.root+u.fragment+l.search))}if(!u.options.silent)return u.loadUrl()},u.deactivate=function(){t(window).off("popstate",u.checkUrl).off("hashchange",u.checkUrl),clearInterval(u._checkUrlInterval
),u.active=!1},u.checkUrl=function(){var e=u.getFragment();e===u.fragment&&u.iframe&&(e=u.getFragment(u.getHash(u.iframe)));if(e===u.fragment)return!1;u.iframe&&u.navigate(e,!1),u.loadUrl()},u.loadUrl=function(e){var t=u.fragment=u.getFragment(e);return u.options.routeHandler?u.options.routeHandler(t):!1},u.navigate=function(t,n){if(!u.active)return!1;n===undefined?n={trigger:!0}:e.isBoolean(n)&&(n={trigger:n}),t=u.getFragment(t||"");if(u.fragment===t)return;u.fragment=t;var r=u.root+t;t===""&&r!=="/"&&(r=r.slice(0,-1));if(u._hasPushState)u.history[n.replace?"replaceState":"pushState"]({},document.title,r);else{if(!u._wantsHashChange)return u.location.assign(r);o(u.location,t,n.replace),u.iframe&&t!==u.getFragment(u.getHash(u.iframe))&&(n.replace||u.iframe.document.open().close(),o(u.iframe.location,t,n.replace))}if(n.trigger)return u.loadUrl(t)},u.navigateBack=function(){u.history.back()},u});