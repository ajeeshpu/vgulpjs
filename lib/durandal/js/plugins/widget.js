/**
 * Durandal 2.0.1 Copyright (c) 2012 Blue Spire Consulting, Inc. All Rights Reserved.
 * Available via the MIT license.
 * see: http://durandaljs.com or https://github.com/BlueSpire/Durandal for details.
 */

define(["durandal/system","durandal/composition","jquery","knockout"],function(e,t,n,r){function a(e,n){var i=r.utils.domData.get(e,u);i||(i={parts:t.cloneNodes(r.virtualElements.childNodes(e))},r.virtualElements.emptyNode(e),r.utils.domData.set(e,u,i)),n.parts=i.parts}var i={},s={},o=["model","view","kind"],u="durandal-widget-data",f={getSettings:function(t){var n=r.utils.unwrapObservable(t())||{};if(e.isString(n))return{kind:n};for(var i in n)r.utils.arrayIndexOf(o,i)!=-1?n[i]=r.utils.unwrapObservable(n[i]):n[i]=n[i];return n},registerKind:function(e){r.bindingHandlers[e]={init:function(){return{controlsDescendantBindings:!0}},update:function(t,n,r,i,s){var o=f.getSettings(n);o.kind=e,a(t,o),f.create(t,o,s,!0)}},r.virtualElements.allowedBindings[e]=!0,t.composeBindings.push(e+":")},mapKind:function(e,t,n){t&&(s[e]=t),n&&(i[e]=n)},mapKindToModuleId:function(e){return i[e]||f.convertKindToModulePath(e)},convertKindToModulePath:function(e){return"widgets/"+e+"/viewmodel"},mapKindToViewId
:function(e){return s[e]||f.convertKindToViewPath(e)},convertKindToViewPath:function(e){return"widgets/"+e+"/view"},createCompositionSettings:function(e,t){return t.model||(t.model=this.mapKindToModuleId(t.kind)),t.view||(t.view=this.mapKindToViewId(t.kind)),t.preserveContext=!0,t.activate=!0,t.activationData=t,t.mode="templated",t},create:function(e,n,r,i){i||(n=f.getSettings(function(){return n},e));var s=f.createCompositionSettings(e,n);t.compose(e,s,r)},install:function(e){e.bindingName=e.bindingName||"widget";if(e.kinds){var n=e.kinds;for(var i=0;i<n.length;i++)f.registerKind(n[i])}r.bindingHandlers[e.bindingName]={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,r,i){var s=f.getSettings(t);a(e,s),f.create(e,s,i,!0)}},t.composeBindings.push(e.bindingName+":"),r.virtualElements.allowedBindings[e.bindingName]=!0}};return f});