/**
 * Durandal 2.0.1 Copyright (c) 2012 Blue Spire Consulting, Inc. All Rights Reserved.
 * Available via the MIT license.
 * see: http://durandaljs.com or https://github.com/BlueSpire/Durandal for details.
 */

define(["durandal/system","durandal/viewEngine"],function(e,t){function n(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r.getAttribute("data-view");if(i==t)return r}}function r(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(e,t,n){e=e||"viewmodels",t=t||"views",n=n||t;var i=new RegExp(r(e),"gi");this.convertModuleIdToViewId=function(e){return e.replace(i,t)},this.translateViewIdToArea=function(e,t){return!t||t=="partial"?n+"/"+e:n+"/"+t+"/"+e}},locateViewForObject:function(t,n,r){var i;if(t.getView){i=t.getView();if(i)return this.locateView(i,n,r)}if(t.viewUrl)return this.locateView(t.viewUrl,n,r);var s=e.getModuleId(t);return s?this.locateView(this.convertModuleIdToViewId(s),n,r):this.locateView(this.determineFallbackViewId(t),n,r)},convertModuleIdToViewId:function(e){return e},determineFallbackViewId:function(e){var t=/function (.{1,})\(/,n=t.exec(e.constructor.toString()),r=n&&n.length>1?n[1]:"";return"views/"+r},translateViewIdToArea
:function(e,t){return e},locateView:function(r,i,s){if(typeof r=="string"){var o;t.isViewUrl(r)?o=t.convertViewUrlToViewId(r):o=r,i&&(o=this.translateViewIdToArea(o,i));if(s){var u=n(s,o);if(u)return e.defer(function(e){e.resolve(u)}).promise()}return t.createView(o)}return e.defer(function(e){e.resolve(r)}).promise()}}});